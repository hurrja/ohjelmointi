#+INCLUDE: ohjelmointi-kappaleiden-yhteiset-asetukset.org

* Animaatio
** Esimerkki
   Kirjoitetaan ohjelma, joka piirtää alla olevan animaation.
   #+NAME: animaatio-ympyra
   #+BEGIN_SRC processing 
     int x; // piirretyn ympyrän keskipisteen x-koordinaatti

     void setup ()
     {
       size (400, 400);
       colorMode (HSB, 100);

       // piirtotaajuus: funktiota draw() kutsutaan 30 kertaa sekunnissa
       frameRate (30); 

       // ympyrän keskipiste on alussa vasemmassa reunassa
       x = 0;
     }

     void draw ()
     {
       final float HALKAISIJA = 20;
       background (0); // musta tausta
       ellipse (x, height / 2.0, HALKAISIJA, HALKAISIJA); // ympyrä
       x++; // kasvatetaan muuttujan x arvoa

       // takaisin vasempaan reunaan, jos mentiin oikeasta reunasta yli
       if (x >= width)
         x = 0;
     }
   #+END_SRC

   Animaatio voidaan piirtää alla olevalla ohjelmalla. Ohjelma toimii
   seuraavasti.
   - Toisin kuin edellisessä kappaleessa, funktiossa ~setup()~ /ei
     kutsuta/ funktiota ~noLoop()~.
   - Tällöin funktiota ~draw()~ kutsutaan automaattisesti toistuvasti.
   - Funktiokutsu 
     #+BEGIN_EXAMPLE
     frameRate (30); 
     #+END_EXAMPLE
     aiheuttaa sen, että funktiota ~draw()~ kutsutaan toistuvasti
     30 kertaa sekunnissa.
   - Funktiossa ~draw()~ piirretään musta tausta ja valkoinen ympyrä,
     jonka \(x\)-koordinaatti on muuttujassa ~x~.
   - Muuttuja ~x~ on globaali muuttuja, jotta se säilyttää arvonsa
     koko ohjelman suorituksen ajan.
   - Jos ympyrän keskipiste siirtyisi kuvan ulkopuolelle (~x >=
     width~), siirrytään takaisin kuvan vasempaan reunaan (~x = 0~).
   #+BEGIN_SRC processing :noweb yes :exports code
   <<animaatio-ympyra>>
   #+END_SRC
** Animaatiosilmukka
   Alla oleva vuokaavio havainnollistaa /animaatiosilmukan/
   toimintaa. Processing-ohjelman alussa funktiota ~setup()~ kutsutaan
   kerran. Sen jälkeen funktiota ~draw()~ kutsutaan toistuvasti
   silmukassa, mikäli funktiota ~noLoop()~ ei ole kutsuttu.
   #+NAME: animaatiosilmukka
   #+BEGIN_SRC asymptote :file animaatiosilmukka.svg :cache yes
     import flowchart;
     import unicode;

     size (15cm, 0);

     block startBlock = rectangle ("\texttt{setup ()}", (0, 0));
     block updateBlock = rectangle ("\texttt{draw ()}", (1, 0));
     block systemBlock = rectangle ("odotellaan", (2, 0));
     pair p = (2, -.5);
     dot (p, invisible);

     draw (startBlock);
     draw (updateBlock);
     draw (systemBlock);

     add (new void (picture pic, transform t)
          {
            draw(pic,
   	      path (new pair[] {startBlock.right (t), updateBlock.left (t)},
   		    Horizontal),
   	      Arrow,
   	      PenMargin);
            draw(pic,
   	      path (new pair[] {updateBlock.right (t), systemBlock.left (t)},
   		    Horizontal),
   	      Arrow,
   	      PenMargin);
            draw(pic,
   	      path (new pair[] {systemBlock.bottom (t), t * p},
   		    Vertical),
   	      PenMargin);
            draw(pic,
   	      path (new pair[] {t * p, updateBlock.bottom (t)},
   		    Horizontal),
   	      Arrow,
   	      PenMargin);
          }
          );

   #+END_SRC

   #+RESULTS[319bf6f9ef2ddbc805a8f726152680b68b0eb98a]: animaatiosilmukka
   [[file:animaatiosilmukka.svg]]

** Animaatiot näillä sivuilla
   #+BEGIN_QUOTE
   Koska useat animaatiot samalla sivulla voivat aiheuttaa ongelmia
   selaimessa, näillä sivuilla on korkeintaan yksi animaatio
   sivulla. Tämän takia alla olevat animaatiot ovat kukin omalla
   sivullaan.
   #+END_QUOTE
** Esimerkki
   Alle oleva ohjelmakoodi piirtää [[file:animaatio-kulunut-aika-sivu.org][tällä sivulla]] näkyvän animaation,
   jossa piirtoikkunan keskellä näytetään ohjelman alusta kulunut aika
   sekunteina.

   #+BEGIN_SRC processing :noweb yes :exports code
   <<animaatio-kulunut-aika>>
   #+END_SRC

** Esimerkki
   Alla oleva ohjelmakoodi piirtää [[file:animaatio-oskilloiva-ympyra-sivu.org][tällä sivulla]] olevan animaation,
   jossa piirtoikkunan keskellä oleva ympyrä vuorotellen suurenee ja
   pienenee. Ympyrä on vihreä, jos halkaisija on yli puolet ikkunan
   leveydestä; muuten ympyrä on sininen.

   Ohjelmassa halkaisijan muutos yhdellä askeella on tallennettu
   muuttujaan ~muutos~. Halkaisijan muutos on ohjelman alussa yhdellä
   askeleella 1. Jos ympyrä ei enää mahtuisi piirtoikkunaan, ympyrää
   aletaan pienentää, jolloin muuttujan ~muutos~ arvoksi tulee
   ~-muutos~ eli \(-1.\) Vastaavasti, kun halkaisijaa pienennetään voi
   käydä niin, että halkaisijan arvo olisi seuraavalla askeleella
   pienempi tai yhtä suuri kuin nolla. Tällöin halkaisijaa ryhdytään
   taas kasvattamaan.

   #+BEGIN_SRC processing :noweb yes :exports code
   <<animaatio-oskilloiva-ympyra>>
   #+END_SRC
   
** Tehtäviä
   1. Tee [[file:animaatio-nelio-sivu.org][tällä sivulla]] näkyvä animaatio. Voit valita piirtoikkunan ja
      neliön koot vapaasti.
   2. Tee [[file:animaatio-varisavy-sivu.org][tällä sivulla]] näkyvä animaatio, jossa ikkunan taustavärin
      värisävy muuttuu yhdellä yksiköllä kunkin askeleen aikana.
   3. Tee [[file:animaatio-viiva-sivu.org][tällä sivulla]] näkyvä animaatio. Kokeile mitä animaatiossa
      tapahtuu, jos funktiosta ~draw()~ poistetaan funktion
      ~background()~ kutsu.
   4. Tee alla olevan kaltainen liikennevalo, joissa väri vaihtuu
      viiden sekunnin välein. [Vihjeitä. Kuluneiden 5 sekunnin
      jaksojen lukumäärän saat jakamalla sekuntien lukumäärän
      luvulla 5. Sen, minkä kolmesta valosta pitäisi olla päällä voi
      tämän jälkeen selvittää laskemalla jakojäännöksen, kun jaksojen
      lukumäärän jaetaan luvulla 3.]
      #+NAME: animaatio-liikennevalot-generaattori
      #+BEGIN_SRC elisp :var toIntegerStr="%s" :exports none
        (concat "int aika; // alusta kulunut aika kokonaisina sekunteina

        void setup ()
        {
          size (200, 200);
          colorMode (HSB, 100);
          aika = 0;
          frameRate (1);
        }

        void draw ()
        {
          float savy;
          int jaksot = "
          (format toIntegerStr "aika / 5")
          "; // kuinka monta 5s jaksoa on kulunut
          int vaihe = jaksot % 3; // mikä vaihe on menossa
          if (vaihe == 0)
            savy = 0; // punainen
          else if (vaihe == 1)
            savy = 17; // keltainen
          else
            savy = 35; // vihreä

          background (savy, 100, 100);
          aika++;
        }
        ")
      #+END_SRC

      #+BEGIN_SRC processing :noweb yes
      <<animaatio-liikennevalot-generaattori("floor(%s)")>>
      #+END_SRC
   5. Tee ohjelma, joka piirtää [[file:animaatio-valmiuspalkki-sivu.org][tällä sivulla]] näkyvän
      animaation. Animaatiossa palkki on vihreä, jos sen pituus on yli
      75\thinsp{}% piirtoikkunan leveydestä; muutoin palkki on
      punainen.
** Ratkaisuja
   1. 
       #+BEGIN_SRC processing :noweb yes :exports code
       <<animaatio-nelio>>
       #+END_SRC
   2. 
       #+BEGIN_SRC processing :noweb yes :exports code
       <<animaatio-varisavy>>
       #+END_SRC
   3. Jos funktiota ~background()~ ei kutsuta, kaikki piirretyt viivat
      jäävät näkyviin. 
       #+BEGIN_SRC processing :noweb yes :exports code
       <<animaatio-viiva>>
       #+END_SRC
   4. 
       #+BEGIN_SRC processing :noweb yes :exports code
       <<animaatio-liikennevalot-generaattori()>>
       #+END_SRC
   5. 
       #+BEGIN_SRC processing :noweb yes :exports code
       <<animaatio-valmiuspalkki>>
       #+END_SRC

#+INCLUDE: animaatio-valmiuspalkki.org
#+INCLUDE: animaatio-kulunut-aika.org
#+INCLUDE: animaatio-oskilloiva-ympyra.org
#+INCLUDE: animaatio-nelio.org
#+INCLUDE: animaatio-varisavy.org
#+INCLUDE: animaatio-viiva.org
